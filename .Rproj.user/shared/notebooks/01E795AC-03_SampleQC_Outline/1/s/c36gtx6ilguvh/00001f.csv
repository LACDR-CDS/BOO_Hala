"0","#Get unique experimental conditions (mean_IDs) and Initialize a list to store the max_r2 for each sample"
"0","unique_mean_ids <- unique(metaData$mean_ID)"
"0","sample_max_correlations_list <- list()"
"0",""
"0","# 3. Loop through each unique experimental condition (mean_ID)"
"0",""
"0","for (current_mean_id in unique_mean_ids) {"
"0","  sample_ids_in_group <- metaData %>%"
"0","    filter(mean_ID == current_mean_id) %>%"
"0","    pull(sample_ID)"
"0","  "
"0","  if (length(sample_ids_in_group) > 1) {"
"0","    valid_samples_in_group <- intersect(sample_ids_in_group, colnames(logcpmData))"
"0","    "
"0","    if (length(valid_samples_in_group) < 2) {"
"0","        for(sample_id_single in sample_ids_in_group){"
"0","             sample_max_correlations_list[[sample_id_single]] <- NA_real_"
"0","        }"
"0","        next "
"0","    }"
"0","      "
"0","    logcpm_subset_for_group <- logcpmData[, valid_samples_in_group, drop = FALSE]"
"0","    correlation_matrix <- cor(logcpm_subset_for_group, method = ""pearson"")"
"0","    "
"0","    for (sample_name in colnames(correlation_matrix)) {"
"0","      correlations_with_others <- correlation_matrix[sample_name, colnames(correlation_matrix) != sample_name]"
"0","      "
"0","      if (length(correlations_with_others) > 0) {"
"0","        sample_max_correlations_list[[sample_name]] <- max(correlations_with_others, na.rm = TRUE)"
"0","      } else {"
"0","        sample_max_correlations_list[[sample_name]] <- NA_real_ "
"0","      }"
"0","    }"
"0","  } else {"
"0","    if (length(sample_ids_in_group) == 1) {"
"0","      sample_max_correlations_list[[sample_ids_in_group[1]]] <- NA_real_"
"0","    }"
"0","  }"
"0","}"
"0",""
"0","#  Convert the list of max correlations into a data frame"
"0","replicateFilterOutput <- data.frame("
"0","  sample_ID = names(sample_max_correlations_list),"
"0","  max_r2 = unlist(sample_max_correlations_list),"
"0","  row.names = NULL "
"0",")"
"0",""
"0","if (nrow(replicateFilterOutput) > 0) {"
"0","  print(head(replicateFilterOutput))"
"0","}"
