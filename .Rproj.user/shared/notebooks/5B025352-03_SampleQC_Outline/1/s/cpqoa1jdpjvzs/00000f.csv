"0","# Calculate new library sizes from the current (probe-QC'd) countData"
"0","recalculated_library_sizes <- colSums(countData)"
"0",""
"0",""
"0","#Create a data frame from these new library sizes for merging."
"0","new_lib_size_df <- data.frame("
"0","  sample_ID = names(recalculated_library_sizes),"
"0","  lib_size_recalculated = recalculated_library_sizes,"
"0","  row.names = NULL # Ensure default row names for this temporary df"
"0",")"
"0","# 3. Merge the new library sizes into 'metaData'."
"0","if (""lib_size"" %in% colnames(metaData)) {"
"0","  metaData <- metaData %>% select(-lib_size)"
"0","  cat(""Removed existing 'lib_size' column from 'metaData'.\n"")"
"0","}"
"1","Removed existing 'lib_size' column from 'metaData'.
"
"0","metaData <- metaData %>% "
"0","  select(-any_of(c(""lib_size_recalculated"", ""lib_size.x"", ""lib_size.y"")))"
"0",""
"0","metaData <- metaData %>%"
"0","  left_join(new_lib_size_df, by = ""sample_ID"") %>%"
"0","  rename(lib_size = lib_size_recalculated)"
"0",""
"0","print(head(metaData %>% select(sample_ID, lib_size, any_of(c(""low_reads_flag"", ""low_corr_flag"")))))"
