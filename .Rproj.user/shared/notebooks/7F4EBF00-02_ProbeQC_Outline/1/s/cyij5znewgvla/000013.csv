"0","# 1. Prepare data for plotting:"
"0","plot_data_relevance_dist <- manifest %>%"
"0","  filter(flag_realignment != ""Remove"") %>% "
"0","  filter(!is.na(average_cpm)) %>%        "
"0","  mutate("
"0","    log2_avg_cpm_plus_1 = log2(average_cpm + 1),"
"0","    passes_relevance_filter = if_else(is.na(passes_relevance_filter), FALSE, passes_relevance_filter), "
"0","    passes_relevance_filter = factor(passes_relevance_filter, "
"0","                                     levels = c(TRUE, FALSE), "
"0","                                     labels = c(""Passed Filter (Relevant in >=1 Cond.)"", "
"0","                                                ""Failed Filter (Relevant in 0 Cond.)""))"
"0","  )"
"0",""
"0","# This 'if' condition checks if there's any data left to plot after filtering."
"0","if (nrow(plot_data_relevance_dist) > 0) {"
"0",""
"0","  # 2. Create the density plot"
"0","  relevance_dist_plot <- ggplot(plot_data_relevance_dist, aes(x = log2_avg_cpm_plus_1, fill = passes_relevance_filter)) +"
"0","    geom_density(alpha = 0.6, na.rm = TRUE) + "
"0","    scale_fill_manual(values = c(""Passed Filter (Relevant in >=1 Cond.)"" = ""darkgreen"", "
"0","                                 ""Failed Filter (Relevant in 0 Cond.)"" = ""salmon"")) +"
"0","    labs("
"0","      title = ""Distribution of log2(Average CPM + 1) by Relevance Filter Status"","
"0","      subtitle = ""Comparing probes that passed vs. failed the relevance filter\n(Relevance: CPM > 1 in >=2/3 replicates in at least 1 condition)"","
"0","      x = ""log2(Average CPM + 1)"","
"0","      y = ""Density"","
"0","      fill = ""Relevance Filter Status:"""
"0","    ) +"
"0","    theme_minimal(base_size = 12) +"
"0","    theme("
"0","      plot.title = element_text(hjust = 0.5, face = ""bold""),"
"0","      plot.subtitle = element_text(hjust = 0.5, size = 10),"
"0","      legend.position = ""top"""
"0","    )"
"0","    "
"0",""
"0","  # Display the plot"
"0","  print(relevance_dist_plot)"
"0",""
"0","} else {"
"0","  cat(""No data available for plotting 'log2_avg_cpm_plus_1' distribution by relevance.\nPlease check the 'manifest' object and the results of previous exercises.\n"")"
"0","}"
