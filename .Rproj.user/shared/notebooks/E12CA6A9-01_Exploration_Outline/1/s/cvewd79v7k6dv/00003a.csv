"0","# Prepare data for plotting"
"0","plot_data_for_layout <- metaData %>%"
"0","  mutate("
"0","    plate_row_ordered = factor(plate_row, levels = rev(sort(unique(metaData$plate_row))))"
"0","  ) %>% "
"0","  mutate("
"0","    well_content = case_when("
"0","      sample_type == ""Treatment"" & !is.na(compound_abbr) & compound_abbr != """" ~ compound_abbr,"
"0","      sample_type == ""Treatment"" ~ compound_name, # Fallback if compound_abbr is NA or empty"
"0","      sample_type == ""Control"" & !is.na(control_type) & control_type != """" ~ control_type,"
"0","      sample_type == ""Control"" ~ compound_name,   # Fallback if control_type is NA or empty (e.g. ""DMSO"")"
"0","      TRUE ~ ""Other"" # For any other cases"
"0","    )"
"0","  )"
"0",""
"0","# Determine the range of columns for x-axis breaks"
"0","plate_col_breaks <- sort(unique(plot_data_for_layout$plate_col))"
"0",""
"0","# 2. Create the plate layout plot using ggplot2"
"0","plate_layout_visualization <- ggplot(plot_data_for_layout, "
"0","                                   aes(x = plate_col, y = plate_row_ordered, fill = well_content)) +"
"0","  geom_tile(color = ""grey60"", linewidth = 0.25) + "
"0","  facet_wrap(~ plate_ID, ncol = 1) + "
"0","  "
"0","  scale_x_continuous(breaks = plate_col_breaks, labels = plate_col_breaks, expand = c(0,0)) +"
"0","  # y-axis is already ordered by 'plate_row_ordered' factor levels"
"0","  "
"0","  labs("
"0","    title = ""Experimental Plate Layout"","
"0","    subtitle = paste(""Wells colored by content (e.g., Compound Abbreviation or Control Type). Total plates:"", n_distinct(plot_data_for_layout$plate_ID)),"
"0","    x = ""Plate Column"","
"0","    y = ""Plate Row"","
"0","    fill = ""Well Content:"" "
"0","  ) +"
"0","  theme_minimal(base_size = 10) + # A clean theme"
"0","  theme("
"0","    plot.title = element_text(hjust = 0.5, face = ""bold"", size = 14),"
"0","    plot.subtitle = element_text(hjust = 0.5, size = 10),"
"0","    axis.text = element_text(size = 8), "
"0","    axis.title = element_text(size = 10, face = ""bold""),"
"0","    strip.text = element_text(face = ""bold"", size = 11), "
"0","    legend.position = ""bottom"", "
"0","    legend.title = element_text(face=""bold""),"
"0","    panel.spacing = unit(1.5, ""lines"")"
"0","  ) +"
"0","  coord_equal()"
"0",""
"0","# Display the plot"
"0","print(plate_layout_visualization)"
